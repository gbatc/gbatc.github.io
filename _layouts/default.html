<!DOCTYPE html>
<html lang="{{ site.lang | default: "en-US" }}">

  <head>
    <!-- General meta -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    {% if page.indexing == false %}
      <meta name="robots" content="noindex">
    {% endif %}

    {% if page.collectionpage %}
      {% seo title=false %}

      {% assign collectiondata = site.collections | where: "label", page.collectionpage | first %}
      <title>{{ collectiondata.title }} - {{ site.title }}</title>
      <meta property="og:title" content="{{ collectiondata.title }}">
      <meta name="description" content="{{ collectiondata.description }}">
      <meta property="og:description" content="{{ collectiondata.description }}">
    {% else %}
      {% seo %}
    {% endif %}
    {% if site.fonts.preconnect_urls %}
      {% for url in site.fonts.preconnect_urls %}
        <link rel="preconnect" href="{{ url }}" crossorigin />
      {% endfor %}
    {% endif %}

    <link rel="manifest" href="{{ "/manifest.json" | relative_url }}">
    <meta name="theme-color" content="{{ site.manifest.theme_color | default: '#242e2b' }}"/>

    {% if site.css_inline == true %}
      {% include site-styles.html %}
    {% else %}
      <link rel="stylesheet" href="{{ "/assets/styles.css" | relative_url }}">
    {% endif %}

    {% if site.favicons or site.avatarurl %}{% include site-favicons.html %}{% endif %}

    {% if site.google_analytics %}{% include site-analytics.html %}{% endif %}

    {% include site-fonts.html %}

    {% include site-before-start.html %}

      {%- comment -%} KaTeX CSS（只需要样式与字体） {%- endcomment -%}
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css"
          integrity="sha384-yfGgM5Yy9mDkXQNXgUGmC71hAqPhZK3xJgynKQhaxq2sVw0u7F3dOZ+qkQ8QxQvC"
          crossorigin="anonymous">

  </head>
  
    <!-- 你已有的 KaTeX CSS -->
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css"
          crossorigin="anonymous">

    <!-- 关键：强力兜底，确保 MathML 被隐藏、可视 HTML 层可见 -->
    <style>
      /* 隐藏可访问性用的 MathML 层，避免“纯文本重复” */
      html body .katex .katex-mathml{
        position:absolute !important;
        left:0 !important; top:0 !important;
        height:1px !important; width:1px !important;
        overflow:hidden !important;
        clip:rect(1px,1px,1px,1px) !important;
        clip-path:inset(50%) !important;
        white-space:nowrap !important;
        margin:0 !important; padding:0 !important; border:0 !important;
        opacity:0 !important; visibility:hidden !important;
      }
      /* 确保真正显示的 HTML 层永远可见 */
      html body .katex .katex-html{
        display:inline-block !important;
        position:static !important;
        clip:auto !important;
        clip-path:none !important;
        height:auto !important; width:auto !important;
        overflow:visible !important;
        white-space:normal !important;
        opacity:1 !important; visibility:visible !important;
      }
      /* 块级公式的外边距（防主题压扁） */
      .katex-display{ display:block !important; margin:1em 0 !important; }
      .katex-display > .katex{ display:block !important; }
    </style>



  <body class="layout-{{ page.layout }}{% if page.title %}  {{ page.title | slugify }}{% endif %}">
    {% include site-icons.svg %}

    {{ content }}

    {% if site.service_worker != false %}{% include site-sw.html %}{% endif %}

    {% include site-before-end.html %}
  </body>


</html>
